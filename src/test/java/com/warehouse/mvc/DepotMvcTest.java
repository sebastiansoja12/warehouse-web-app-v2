package com.warehouse.mvc;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.warehouse.model.Depot;
import com.warehouse.repository.DepotRepository;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.http.MediaType;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.MvcResult;
import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;
import org.springframework.test.web.servlet.result.MockMvcResultMatchers;

import javax.transaction.Transactional;

import static org.assertj.core.api.Assertions.assertThat;
import static org.mockito.Mockito.mock;
import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

@SpringBootTest
@AutoConfigureMockMvc
class DepotMvcTest {

    @Autowired
    private DepotRepository depotRepository;

    @Autowired
    private MockMvc mockMvc;

    @Autowired
    private ObjectMapper objectMapper;

    @Test
    @Transactional
    void shouldGetSingleDepot() throws Exception {
        //given
        Depot depot = new Depot();
        depot.setCity("Rybnik");
        depot.setStreet("Kolorowa 12");
        depot.setCountry("Polska");
        depot.setDepotCode("RB1");
        depotRepository.save(depot);
        //when
        MvcResult mvcResult = mockMvc.perform(MockMvcRequestBuilders.get("/api/depots/" + depot.getId()))
                .andDo(print())
                .andExpect(status().is(200))
                .andReturn();
        //then
        Depot depotToTest = objectMapper.readValue(mvcResult.getResponse().getContentAsString(), Depot.class);

        assertThat(depotToTest).isNotNull();
        assertThat(depotToTest.getCountry()).isEqualTo("Polska");
        assertThat(depotToTest.getCity()).isEqualTo("Rybnik");
        assertThat(depotToTest.getStreet()).isEqualTo("Kolorowa 12");
        assertThat(depotToTest.getDepotCode()).isEqualTo("RB1");
    }

    @Test
    @Transactional
    void shouldThrowServerError() throws Exception {
        // given
        Depot depot = new Depot();
        depot.setCity("Rybnik");
        depot.setStreet("Kolorowa 12");
        depot.setCountry("Polska");
        depot.setDepotCode("RB1");
        depotRepository.save(depot);

        //when
        MvcResult mvcResult = mockMvc.perform(MockMvcRequestBuilders.get("/api/depots/" + 69))
                .andDo(print())
                .andExpect(status().is(200))
                .andReturn();

        Depot depotToTest = objectMapper.readValue(mvcResult.getResponse().getContentAsString(), Depot.class);

        // then
        assertThat(depotToTest).isNull();
    }

    @Test
    @Transactional
    void shouldNotInsertIncorrectData() throws Exception {
        // given
        Depot depot = new Depot();
        depotRepository.save(depot);

        // when
        MvcResult mvcResult = mockMvc.perform(MockMvcRequestBuilders.post("/api/depots" + depot))
                .andDo(print())
                .andExpect(status().is(403))
                .andReturn();

        // AND expect
        MvcResult returnNothing = mockMvc.perform(
                        MockMvcRequestBuilders.get("/api/depots/" + depot.getDepotCode()))
                .andDo(print())
                .andExpect(status().is(500))
                .andReturn();


        // then
        assertThat(mvcResult.getResponse().getContentAsString()).isNotNull();
        assertThat(returnNothing.getResponse().getContentAsString()).isEqualTo(getError());
    }


    @Test
    void getAllDepotsAPI() throws Exception {
        mockMvc.perform(MockMvcRequestBuilders
                        .get("/api/depots")
                        .accept(MediaType.APPLICATION_JSON))
                .andDo(print())
                .andExpect(status().isOk())
                .andExpect(MockMvcResultMatchers.jsonPath("$").exists())
                .andReturn().getResponse().getContentAsString();
    }

    @Test
    void getDepotByDepotCodeAPI() throws Exception {
        mockMvc.perform(MockMvcRequestBuilders
                        .get("/api/depots/{depotCode}", 1)
                        .accept(MediaType.APPLICATION_JSON))
                .andDo(print())
                .andExpect(status().isOk())
                .andExpect(MockMvcResultMatchers.jsonPath("$.depotCode").value("KT3"));
    }

    public String getError() {
        return "{\"cause\":null,\"stackTrace\":[{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"handleAllOtherErrors\",\"fileName\":\"JsonExceptionHandler.java\",\"lineNumber\":18,\"className\":\"com.warehouse.exceptions.JsonExceptionHandler\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.14\",\"methodName\":\"invoke0\",\"fileName\":\"NativeMethodAccessorImpl.java\",\"lineNumber\":-2,\"className\":\"jdk.internal.reflect.NativeMethodAccessorImpl\",\"nativeMethod\":true},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.14\",\"methodName\":\"invoke\",\"fileName\":\"NativeMethodAccessorImpl.java\",\"lineNumber\":62,\"className\":\"jdk.internal.reflect.NativeMethodAccessorImpl\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.14\",\"methodName\":\"invoke\",\"fileName\":\"DelegatingMethodAccessorImpl.java\",\"lineNumber\":43,\"className\":\"jdk.internal.reflect.DelegatingMethodAccessorImpl\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.14\",\"methodName\":\"invoke\",\"fileName\":\"Method.java\",\"lineNumber\":566,\"className\":\"java.lang.reflect.Method\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doInvoke\",\"fileName\":\"InvocableHandlerMethod.java\",\"lineNumber\":190,\"className\":\"org.springframework.web.method.support.InvocableHandlerMethod\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"invokeForRequest\",\"fileName\":\"InvocableHandlerMethod.java\",\"lineNumber\":138,\"className\":\"org.springframework.web.method.support.InvocableHandlerMethod\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"invokeAndHandle\",\"fileName\":\"ServletInvocableHandlerMethod.java\",\"lineNumber\":105,\"className\":\"org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doResolveHandlerMethodException\",\"fileName\":\"ExceptionHandlerExceptionResolver.java\",\"lineNumber\":403,\"className\":\"org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doResolveException\",\"fileName\":\"AbstractHandlerMethodExceptionResolver.java\",\"lineNumber\":61,\"className\":\"org.springframework.web.servlet.handler.AbstractHandlerMethodExceptionResolver\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"resolveException\",\"fileName\":\"AbstractHandlerExceptionResolver.java\",\"lineNumber\":141,\"className\":\"org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"resolveException\",\"fileName\":\"HandlerExceptionResolverComposite.java\",\"lineNumber\":80,\"className\":\"org.springframework.web.servlet.handler.HandlerExceptionResolverComposite\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"processHandlerException\",\"fileName\":\"DispatcherServlet.java\",\"lineNumber\":1300,\"className\":\"org.springframework.web.servlet.DispatcherServlet\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"processHandlerException\",\"fileName\":\"TestDispatcherServlet.java\",\"lineNumber\":143,\"className\":\"org.springframework.test.web.servlet.TestDispatcherServlet\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"processDispatchResult\",\"fileName\":\"DispatcherServlet.java\",\"lineNumber\":1111,\"className\":\"org.springframework.web.servlet.DispatcherServlet\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doDispatch\",\"fileName\":\"DispatcherServlet.java\",\"lineNumber\":1057,\"className\":\"org.springframework.web.servlet.DispatcherServlet\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doService\",\"fileName\":\"DispatcherServlet.java\",\"lineNumber\":943,\"className\":\"org.springframework.web.servlet.DispatcherServlet\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"processRequest\",\"fileName\":\"FrameworkServlet.java\",\"lineNumber\":1006,\"className\":\"org.springframework.web.servlet.FrameworkServlet\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doGet\",\"fileName\":\"FrameworkServlet.java\",\"lineNumber\":898,\"className\":\"org.springframework.web.servlet.FrameworkServlet\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"service\",\"fileName\":\"HttpServlet.java\",\"lineNumber\":626,\"className\":\"javax.servlet.http.HttpServlet\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"service\",\"fileName\":\"FrameworkServlet.java\",\"lineNumber\":883,\"className\":\"org.springframework.web.servlet.FrameworkServlet\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"service\",\"fileName\":\"TestDispatcherServlet.java\",\"lineNumber\":72,\"className\":\"org.springframework.test.web.servlet.TestDispatcherServlet\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"service\",\"fileName\":\"HttpServlet.java\",\"lineNumber\":733,\"className\":\"javax.servlet.http.HttpServlet\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"MockFilterChain.java\",\"lineNumber\":167,\"className\":\"org.springframework.mock.web.MockFilterChain$ServletFilterProxy\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"MockFilterChain.java\",\"lineNumber\":134,\"className\":\"org.springframework.mock.web.MockFilterChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilterInternal\",\"fileName\":\"CorsFilter.java\",\"lineNumber\":92,\"className\":\"org.springframework.web.filter.CorsFilter\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"OncePerRequestFilter.java\",\"lineNumber\":119,\"className\":\"org.springframework.web.filter.OncePerRequestFilter\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"MockFilterChain.java\",\"lineNumber\":134,\"className\":\"org.springframework.mock.web.MockFilterChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilterInternal\",\"fileName\":\"JwtAuthenticationFilter.java\",\"lineNumber\":48,\"className\":\"com.warehouse.security.JwtAuthenticationFilter\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"OncePerRequestFilter.java\",\"lineNumber\":119,\"className\":\"org.springframework.web.filter.OncePerRequestFilter\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"MockFilterChain.java\",\"lineNumber\":134,\"className\":\"org.springframework.mock.web.MockFilterChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"WebConfig.java\",\"lineNumber\":41,\"className\":\"com.warehouse.config.WebConfig\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"MockFilterChain.java\",\"lineNumber\":134,\"className\":\"org.springframework.mock.web.MockFilterChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"FilterChainProxy.java\",\"lineNumber\":320,\"className\":\"org.springframework.security.web.FilterChainProxy$VirtualFilterChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"invoke\",\"fileName\":\"FilterSecurityInterceptor.java\",\"lineNumber\":126,\"className\":\"org.springframework.security.web.access.intercept.FilterSecurityInterceptor\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"FilterSecurityInterceptor.java\",\"lineNumber\":90,\"className\":\"org.springframework.security.web.access.intercept.FilterSecurityInterceptor\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"FilterChainProxy.java\",\"lineNumber\":334,\"className\":\"org.springframework.security.web.FilterChainProxy$VirtualFilterChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"ExceptionTranslationFilter.java\",\"lineNumber\":118,\"className\":\"org.springframework.security.web.access.ExceptionTranslationFilter\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"FilterChainProxy.java\",\"lineNumber\":334,\"className\":\"org.springframework.security.web.FilterChainProxy$VirtualFilterChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"SessionManagementFilter.java\",\"lineNumber\":137,\"className\":\"org.springframework.security.web.session.SessionManagementFilter\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"FilterChainProxy.java\",\"lineNumber\":334,\"className\":\"org.springframework.security.web.FilterChainProxy$VirtualFilterChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"AnonymousAuthenticationFilter.java\",\"lineNumber\":111,\"className\":\"org.springframework.security.web.authentication.AnonymousAuthenticationFilter\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"FilterChainProxy.java\",\"lineNumber\":334,\"className\":\"org.springframework.security.web.FilterChainProxy$VirtualFilterChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"SecurityContextHolderAwareRequestFilter.java\",\"lineNumber\":158,\"className\":\"org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"FilterChainProxy.java\",\"lineNumber\":334,\"className\":\"org.springframework.security.web.FilterChainProxy$VirtualFilterChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"RequestCacheAwareFilter.java\",\"lineNumber\":63,\"className\":\"org.springframework.security.web.savedrequest.RequestCacheAwareFilter\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"FilterChainProxy.java\",\"lineNumber\":334,\"className\":\"org.springframework.security.web.FilterChainProxy$VirtualFilterChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"LogoutFilter.java\",\"lineNumber\":116,\"className\":\"org.springframework.security.web.authentication.logout.LogoutFilter\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"FilterChainProxy.java\",\"lineNumber\":334,\"className\":\"org.springframework.security.web.FilterChainProxy$VirtualFilterChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doHeadersAfter\",\"fileName\":\"HeaderWriterFilter.java\",\"lineNumber\":92,\"className\":\"org.springframework.security.web.header.HeaderWriterFilter\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilterInternal\",\"fileName\":\"HeaderWriterFilter.java\",\"lineNumber\":77,\"className\":\"org.springframework.security.web.header.HeaderWriterFilter\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"OncePerRequestFilter.java\",\"lineNumber\":119,\"className\":\"org.springframework.web.filter.OncePerRequestFilter\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"FilterChainProxy.java\",\"lineNumber\":334,\"className\":\"org.springframework.security.web.FilterChainProxy$VirtualFilterChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"SecurityContextPersistenceFilter.java\",\"lineNumber\":105,\"className\":\"org.springframework.security.web.context.SecurityContextPersistenceFilter\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"FilterChainProxy.java\",\"lineNumber\":334,\"className\":\"org.springframework.security.web.FilterChainProxy$VirtualFilterChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilterInternal\",\"fileName\":\"WebAsyncManagerIntegrationFilter.java\",\"lineNumber\":56,\"className\":\"org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"OncePerRequestFilter.java\",\"lineNumber\":119,\"className\":\"org.springframework.web.filter.OncePerRequestFilter\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"FilterChainProxy.java\",\"lineNumber\":334,\"className\":\"org.springframework.security.web.FilterChainProxy$VirtualFilterChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilterInternal\",\"fileName\":\"FilterChainProxy.java\",\"lineNumber\":215,\"className\":\"org.springframework.security.web.FilterChainProxy\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"FilterChainProxy.java\",\"lineNumber\":178,\"className\":\"org.springframework.security.web.FilterChainProxy\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"invokeDelegate\",\"fileName\":\"DelegatingFilterProxy.java\",\"lineNumber\":358,\"className\":\"org.springframework.web.filter.DelegatingFilterProxy\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"DelegatingFilterProxy.java\",\"lineNumber\":271,\"className\":\"org.springframework.web.filter.DelegatingFilterProxy\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"MockFilterChain.java\",\"lineNumber\":134,\"className\":\"org.springframework.mock.web.MockFilterChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilterInternal\",\"fileName\":\"CharacterEncodingFilter.java\",\"lineNumber\":201,\"className\":\"org.springframework.web.filter.CharacterEncodingFilter\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"OncePerRequestFilter.java\",\"lineNumber\":119,\"className\":\"org.springframework.web.filter.OncePerRequestFilter\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"doFilter\",\"fileName\":\"MockFilterChain.java\",\"lineNumber\":134,\"className\":\"org.springframework.mock.web.MockFilterChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"perform\",\"fileName\":\"MockMvc.java\",\"lineNumber\":183,\"className\":\"org.springframework.test.web.servlet.MockMvc\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"shouldNotInsertIncorrectData\",\"fileName\":\"DepotMvcTest.java\",\"lineNumber\":98,\"className\":\"com.warehouse.mvc.DepotMvcTest\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.14\",\"methodName\":\"invoke0\",\"fileName\":\"NativeMethodAccessorImpl.java\",\"lineNumber\":-2,\"className\":\"jdk.internal.reflect.NativeMethodAccessorImpl\",\"nativeMethod\":true},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.14\",\"methodName\":\"invoke\",\"fileName\":\"NativeMethodAccessorImpl.java\",\"lineNumber\":62,\"className\":\"jdk.internal.reflect.NativeMethodAccessorImpl\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.14\",\"methodName\":\"invoke\",\"fileName\":\"DelegatingMethodAccessorImpl.java\",\"lineNumber\":43,\"className\":\"jdk.internal.reflect.DelegatingMethodAccessorImpl\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.14\",\"methodName\":\"invoke\",\"fileName\":\"Method.java\",\"lineNumber\":566,\"className\":\"java.lang.reflect.Method\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"invokeMethod\",\"fileName\":\"ReflectionUtils.java\",\"lineNumber\":686,\"className\":\"org.junit.platform.commons.util.ReflectionUtils\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"proceed\",\"fileName\":\"MethodInvocation.java\",\"lineNumber\":60,\"className\":\"org.junit.jupiter.engine.execution.MethodInvocation\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"proceed\",\"fileName\":\"InvocationInterceptorChain.java\",\"lineNumber\":131,\"className\":\"org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"intercept\",\"fileName\":\"TimeoutExtension.java\",\"lineNumber\":149,\"className\":\"org.junit.jupiter.engine.extension.TimeoutExtension\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"interceptTestableMethod\",\"fileName\":\"TimeoutExtension.java\",\"lineNumber\":140,\"className\":\"org.junit.jupiter.engine.extension.TimeoutExtension\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"interceptTestMethod\",\"fileName\":\"TimeoutExtension.java\",\"lineNumber\":84,\"className\":\"org.junit.jupiter.engine.extension.TimeoutExtension\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"lambda$ofVoidMethod$0\",\"fileName\":\"ExecutableInvoker.java\",\"lineNumber\":115,\"className\":\"org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"lambda$invoke$0\",\"fileName\":\"ExecutableInvoker.java\",\"lineNumber\":105,\"className\":\"org.junit.jupiter.engine.execution.ExecutableInvoker\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"proceed\",\"fileName\":\"InvocationInterceptorChain.java\",\"lineNumber\":106,\"className\":\"org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"proceed\",\"fileName\":\"InvocationInterceptorChain.java\",\"lineNumber\":64,\"className\":\"org.junit.jupiter.engine.execution.InvocationInterceptorChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"chainAndInvoke\",\"fileName\":\"InvocationInterceptorChain.java\",\"lineNumber\":45,\"className\":\"org.junit.jupiter.engine.execution.InvocationInterceptorChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"invoke\",\"fileName\":\"InvocationInterceptorChain.java\",\"lineNumber\":37,\"className\":\"org.junit.jupiter.engine.execution.InvocationInterceptorChain\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"invoke\",\"fileName\":\"ExecutableInvoker.java\",\"lineNumber\":104,\"className\":\"org.junit.jupiter.engine.execution.ExecutableInvoker\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"invoke\",\"fileName\":\"ExecutableInvoker.java\",\"lineNumber\":98,\"className\":\"org.junit.jupiter.engine.execution.ExecutableInvoker\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"lambda$invokeTestMethod$6\",\"fileName\":\"TestMethodTestDescriptor.java\",\"lineNumber\":212,\"className\":\"org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"ThrowableCollector.java\",\"lineNumber\":73,\"className\":\"org.junit.platform.engine.support.hierarchical.ThrowableCollector\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"invokeTestMethod\",\"fileName\":\"TestMethodTestDescriptor.java\",\"lineNumber\":208,\"className\":\"org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"TestMethodTestDescriptor.java\",\"lineNumber\":137,\"className\":\"org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"TestMethodTestDescriptor.java\",\"lineNumber\":71,\"className\":\"org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"lambda$executeRecursively$5\",\"fileName\":\"NodeTestTask.java\",\"lineNumber\":135,\"className\":\"org.junit.platform.engine.support.hierarchical.NodeTestTask\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"ThrowableCollector.java\",\"lineNumber\":73,\"className\":\"org.junit.platform.engine.support.hierarchical.ThrowableCollector\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"lambda$executeRecursively$7\",\"fileName\":\"NodeTestTask.java\",\"lineNumber\":125,\"className\":\"org.junit.platform.engine.support.hierarchical.NodeTestTask\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"around\",\"fileName\":\"Node.java\",\"lineNumber\":135,\"className\":\"org.junit.platform.engine.support.hierarchical.Node\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"lambda$executeRecursively$8\",\"fileName\":\"NodeTestTask.java\",\"lineNumber\":123,\"className\":\"org.junit.platform.engine.support.hierarchical.NodeTestTask\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"ThrowableCollector.java\",\"lineNumber\":73,\"className\":\"org.junit.platform.engine.support.hierarchical.ThrowableCollector\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"executeRecursively\",\"fileName\":\"NodeTestTask.java\",\"lineNumber\":122,\"className\":\"org.junit.platform.engine.support.hierarchical.NodeTestTask\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"NodeTestTask.java\",\"lineNumber\":80,\"className\":\"org.junit.platform.engine.support.hierarchical.NodeTestTask\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.14\",\"methodName\":\"forEach\",\"fileName\":\"ArrayList.java\",\"lineNumber\":1541,\"className\":\"java.util.ArrayList\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"invokeAll\",\"fileName\":\"SameThreadHierarchicalTestExecutorService.java\",\"lineNumber\":38,\"className\":\"org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"lambda$executeRecursively$5\",\"fileName\":\"NodeTestTask.java\",\"lineNumber\":139,\"className\":\"org.junit.platform.engine.support.hierarchical.NodeTestTask\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"ThrowableCollector.java\",\"lineNumber\":73,\"className\":\"org.junit.platform.engine.support.hierarchical.ThrowableCollector\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"lambda$executeRecursively$7\",\"fileName\":\"NodeTestTask.java\",\"lineNumber\":125,\"className\":\"org.junit.platform.engine.support.hierarchical.NodeTestTask\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"around\",\"fileName\":\"Node.java\",\"lineNumber\":135,\"className\":\"org.junit.platform.engine.support.hierarchical.Node\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"lambda$executeRecursively$8\",\"fileName\":\"NodeTestTask.java\",\"lineNumber\":123,\"className\":\"org.junit.platform.engine.support.hierarchical.NodeTestTask\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"ThrowableCollector.java\",\"lineNumber\":73,\"className\":\"org.junit.platform.engine.support.hierarchical.ThrowableCollector\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"executeRecursively\",\"fileName\":\"NodeTestTask.java\",\"lineNumber\":122,\"className\":\"org.junit.platform.engine.support.hierarchical.NodeTestTask\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"NodeTestTask.java\",\"lineNumber\":80,\"className\":\"org.junit.platform.engine.support.hierarchical.NodeTestTask\",\"nativeMethod\":false},{\"classLoaderName\":null,\"moduleName\":\"java.base\",\"moduleVersion\":\"11.0.14\",\"methodName\":\"forEach\",\"fileName\":\"ArrayList.java\",\"lineNumber\":1541,\"className\":\"java.util.ArrayList\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"invokeAll\",\"fileName\":\"SameThreadHierarchicalTestExecutorService.java\",\"lineNumber\":38,\"className\":\"org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"lambda$executeRecursively$5\",\"fileName\":\"NodeTestTask.java\",\"lineNumber\":139,\"className\":\"org.junit.platform.engine.support.hierarchical.NodeTestTask\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"ThrowableCollector.java\",\"lineNumber\":73,\"className\":\"org.junit.platform.engine.support.hierarchical.ThrowableCollector\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"lambda$executeRecursively$7\",\"fileName\":\"NodeTestTask.java\",\"lineNumber\":125,\"className\":\"org.junit.platform.engine.support.hierarchical.NodeTestTask\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"around\",\"fileName\":\"Node.java\",\"lineNumber\":135,\"className\":\"org.junit.platform.engine.support.hierarchical.Node\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"lambda$executeRecursively$8\",\"fileName\":\"NodeTestTask.java\",\"lineNumber\":123,\"className\":\"org.junit.platform.engine.support.hierarchical.NodeTestTask\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"ThrowableCollector.java\",\"lineNumber\":73,\"className\":\"org.junit.platform.engine.support.hierarchical.ThrowableCollector\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"executeRecursively\",\"fileName\":\"NodeTestTask.java\",\"lineNumber\":122,\"className\":\"org.junit.platform.engine.support.hierarchical.NodeTestTask\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"NodeTestTask.java\",\"lineNumber\":80,\"className\":\"org.junit.platform.engine.support.hierarchical.NodeTestTask\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"submit\",\"fileName\":\"SameThreadHierarchicalTestExecutorService.java\",\"lineNumber\":32,\"className\":\"org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"HierarchicalTestExecutor.java\",\"lineNumber\":57,\"className\":\"org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"HierarchicalTestEngine.java\",\"lineNumber\":51,\"className\":\"org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"DefaultLauncher.java\",\"lineNumber\":248,\"className\":\"org.junit.platform.launcher.core.DefaultLauncher\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"lambda$execute$5\",\"fileName\":\"DefaultLauncher.java\",\"lineNumber\":211,\"className\":\"org.junit.platform.launcher.core.DefaultLauncher\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"withInterceptedStreams\",\"fileName\":\"DefaultLauncher.java\",\"lineNumber\":226,\"className\":\"org.junit.platform.launcher.core.DefaultLauncher\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"DefaultLauncher.java\",\"lineNumber\":199,\"className\":\"org.junit.platform.launcher.core.DefaultLauncher\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"DefaultLauncher.java\",\"lineNumber\":132,\"className\":\"org.junit.platform.launcher.core.DefaultLauncher\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"startRunnerWithArgs\",\"fileName\":\"JUnit5IdeaTestRunner.java\",\"lineNumber\":71,\"className\":\"com.intellij.junit5.JUnit5IdeaTestRunner\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"execute\",\"fileName\":\"IdeaTestRunner.java\",\"lineNumber\":38,\"className\":\"com.intellij.rt.junit.IdeaTestRunner$Repeater$1\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"repeat\",\"fileName\":\"TestsRepeater.java\",\"lineNumber\":11,\"className\":\"com.intellij.rt.execution.junit.TestsRepeater\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"startRunnerWithArgs\",\"fileName\":\"IdeaTestRunner.java\",\"lineNumber\":35,\"className\":\"com.intellij.rt.junit.IdeaTestRunner$Repeater\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"prepareStreamsAndStart\",\"fileName\":\"JUnitStarter.java\",\"lineNumber\":235,\"className\":\"com.intellij.rt.junit.JUnitStarter\",\"nativeMethod\":false},{\"classLoaderName\":\"app\",\"moduleName\":null,\"moduleVersion\":null,\"methodName\":\"main\",\"fileName\":\"JUnitStarter.java\",\"lineNumber\":54,\"className\":\"com.intellij.rt.junit.JUnitStarter\",\"nativeMethod\":false}],\"message\":\"Failed to convert value of type 'java.lang.String' to required type 'java.lang.Long'; nested exception is java.lang.NumberFormatException: For input string: \\\"null\\\"\",\"suppressed\":[],\"localizedMessage\":\"Failed to convert value of type 'java.lang.String' to required type 'java.lang.Long'; nested exception is java.lang.NumberFormatException: For input string: \\\"null\\\"\"}";
    }

}